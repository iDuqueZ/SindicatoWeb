---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import PreguntasFrecuentes from "../components/PreguntasFrecuentes.astro";
import CalendarioEventos from "../components/CalendarioEventos.astro";
import UltimasPublicaciones from "../components/UltimasPublicaciones.astro";
import Banner from "../components/Banner.astro";
import BaseHeadIndex from "../components/BaseHeadIndex.astro";
import UltimosEventos from "../components/UltimosEventos.jsx";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
---

<!doctype html>
<html lang="es">
  <head>
    <BaseHeadIndex title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <Header />
	<Banner />
    <main class="md:w-[1200px]! mx-auto!">
      <!-- Bot贸n flotante de WhatsApp -->
      <style>
        .boton-flotante-afiliarme {
          position: fixed;
          right: 2rem;
          bottom: 2rem;
          z-index: 50;
          animation: parpadeo 1s infinite alternate;
          box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
          display: flex;
          flex-direction: column;
          align-items: center;
          transition:
            opacity 0.35s,
            transform 0.35s cubic-bezier(0.68, -0.55, 0.27, 1.55);
          /* arrugado: escala y opacidad */
        }
        .boton-flotante-afiliarme.arrugado {
          opacity: 0;
          transform: scale(0.2) rotate(-12deg);
          pointer-events: none;
        }
        @keyframes parpadeo {
          0% {
            opacity: 1;
          }
          100% {
            opacity: 0.5;
          }
        }
        .boton-flotante-afiliarme p {
          display: none;
          position: absolute;
          bottom: 110%;
          right: 0;
          left: auto;
          transform: translateY(0) translateX(0);
          background: #fff;
          color: #166534;
          padding: 0.25rem 0.75rem;
          border-radius: 9999px;
          font-size: 0.95rem;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
          font-weight: 600;
          transition: opacity 0.2s;
          width: max-content;
          max-width: 250px;
          text-align: center;
          white-space: normal;
        }
        .boton-flotante-afiliarme:hover p,
        .boton-flotante-afiliarme:focus-within p {
          display: block;
        }
      </style>

      <div class="boton-flotante-afiliarme" id="botonAfiliarme">
        <p>
          驴Quieres obtener m谩s informaci贸n? <span class="font-normal"
            >Haz clic y te atenderemos v铆a WhatsApp</span>
        </p>
        <a
          href="https://wa.me/+573180056547"
          target="_blank"
          class="tracking-wider text-white! bg-green-700 hover:bg-green-800 focus:outline-none focus:ring-4 focus:ring-green-300 font-medium rounded-full text-sm px-5 py-2.5 text-center dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800 shadow-lg"
          aria-label="Afiliarme por WhatsApp"
        >
          Contactanos
        </a>
      </div>

      <script is:inline>
        // Permite eliminar el bot贸n flotante deslizando en cualquier direcci贸n, sin afectar el texto y con transici贸n arrugada
        const boton = document.getElementById("botonAfiliarme");
        let startX = 0,
          startY = 0,
          moved = false;

        if (boton) {
          boton.addEventListener("touchstart", function (e) {
            if (e.touches.length === 1) {
              startX = e.touches[0].clientX;
              startY = e.touches[0].clientY;
              moved = false;
            }
          });

          boton.addEventListener("touchmove", function (e) {
            if (e.touches.length === 1) {
              const dx = e.touches[0].clientX - startX;
              const dy = e.touches[0].clientY - startY;
              if (Math.abs(dx) > 40 || Math.abs(dy) > 40) {
                moved = true;
              }
            }
          });

          boton.addEventListener("touchend", function (e) {
            if (moved) {
              boton.classList.add("arrugado");
              setTimeout(() => (boton.style.display = "none"), 400);
            }
          });

          // Soporte para mouse (drag)
          let mouseDown = false,
            mouseStartX = 0,
            mouseStartY = 0;
          boton.addEventListener("mousedown", function (e) {
            mouseDown = true;
            mouseStartX = e.clientX;
            mouseStartY = e.clientY;
          });
          document.addEventListener("mousemove", function (e) {
            if (mouseDown) {
              const dx = e.clientX - mouseStartX;
              const dy = e.clientY - mouseStartY;
              if (Math.abs(dx) > 40 || Math.abs(dy) > 40) {
                boton.classList.add("arrugado");
                setTimeout(() => (boton.style.display = "none"), 400);
                mouseDown = false;
              }
            }
          });
          document.addEventListener("mouseup", function () {
            mouseDown = false;
          });
        }
      </script>

      <div class="flex flex-col-reverse md:flex-row md:gap-12 md:justify-between">
        <div class="md:w-[60%]">
          <div class="eventos">
            <UltimosEventos client:load/>
            <CalendarioEventos />
          </div>
          <PreguntasFrecuentes />
        </div>
        <aside class="md:w-[40%]">
          <UltimasPublicaciones />
        </aside>
      </div>

      <p>隆Gracias por visitarnos!</p>
      <p>隆Te esperamos!</p>
    </main>
    <Footer />

    <script>
      declare global {
        interface Window {
          netlifyIdentity: any;
        }
      }

      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", (user: any) => {
          if (!user) {
            window.netlifyIdentity.on("login", () => {
              document.location.href = "/admin/";
            });
          }
        });
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>

    <script is:inline>
      if (typeof Storage !== "undefined") {
        if (
          localStorage.getItem("dark_mode") &&
          localStorage.getItem("dark_mode") === "false"
        ) {
          document.documentElement.classList.remove("dark");
        }
      }
    </script>
  </body>
</html>
